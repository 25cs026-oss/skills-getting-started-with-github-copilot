<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Mergington High — Activities</title>
	<link rel="stylesheet" href="/static/styles.css">
</head>
<body>
	<header>
		<h1>Mergington High — Extracurricular Activities</h1>
		<p class="subtitle">Browse activities and see who is already signed up</p>
	</header>

	<main>
		<div id="activities" class="grid"></div>
	</main>

	<footer>
		<small>Powered by Mergington High School API</small>
	</footer>

	<script>
		// Fetch activities and render cards
		async function loadActivities() {
			try {
				const res = await fetch('/activities');
				if (!res.ok) throw new Error('Failed to load activities');
				const activities = await res.json();
				renderActivities(activities);
			} catch (err) {
				document.getElementById('activities').innerHTML = '<p class="error">Could not load activities.</p>';
				console.error(err);
			}
		}

		function renderActivities(data) {
			const container = document.getElementById('activities');
			container.innerHTML = '';

			Object.entries(data).forEach(([name, info]) => {
				const card = document.createElement('article');
				card.className = 'card';

				card.innerHTML = `
					<h2 class="activity-title">${escapeHtml(name)}</h2>
					<p class="muted">${escapeHtml(info.description)}</p>
					<div class="meta">
						<span class="badge">Schedule: ${escapeHtml(info.schedule)}</span>
						<span class="badge">Capacity: ${info.participants.length} / ${info.max_participants}</span>
					</div>
					<div class="participants">
						<h3>Participants</h3>
						${renderParticipantsList(info.participants)}
					</div>
				`;
				container.appendChild(card);
			});
		}

		function renderParticipantsList(list) {
			if (!Array.isArray(list) || list.length === 0) {
				return `<p class="no-participants">No participants yet — be the first!</p>`;
			}
			const items = list.map(email => `<li>${escapeHtml(email)}</li>`).join('');
			return `<ul class="participants-list">${items}</ul>`;
		}

		// Simple HTML escape to avoid injecting content
		function escapeHtml(str) {
			return String(str)
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#39;');
		}

		// Load on ready
		document.addEventListener('DOMContentLoaded', loadActivities);
	</script>
</body>
</html>
